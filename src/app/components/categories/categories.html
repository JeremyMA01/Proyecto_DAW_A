<div class="encabezado">
    <h2>Gestión de Categorías</h2> 
</div>

<div class="encabezado-acciones">
    <input type="text" class="busquedaInput" placeholder="Buscar categoría..." #busq (keyup)="search(busq)">
    <button class="btn-new" (click)="openNew()"><i class="bi bi-plus-circle me-1"></i> Agregar Categoría</button>
</div>


<!-- Tabla reutilizable -->
<app-reusable-table
  [datos]="categories"
  [columnas]="columnas"
  (editClick)="openEdit($event)"
  (eliminarClick)="openDeleteDialog($event)"
  (newClick)="openNew()">
</app-reusable-table>

<!-- MODAL para agregar/editar -->
<!-- MODAL para agregar/editar -->
<div class="modal fade" id="categorieModal" tabindex="-1" #categorieModalRef>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          {{ editingId ? 'Editar Categoría' : 'Nueva Categoría' }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form [formGroup]="formCategorie">
        <div class="modal-body">
          <!-- NOMBRE -->
          <div class="mb-3">
            <label class="form-label">Nombre *</label>
            <input 
              type="text" 
              class="form-control" 
              formControlName="name" 
              [class.is-invalid]="f['name'].invalid && (f['name'].dirty || f['name'].touched)"
            />
            <div *ngIf="f['name'].invalid && (f['name'].dirty || f['name'].touched)" class="invalid-feedback">
              <small *ngIf="f['name'].errors?.['required']">El nombre es obligatorio.</small>
              <small *ngIf="f['name'].errors?.['minlength']">El nombre debe tener al menos 3 caracteres.</small>
              <small *ngIf="f['name'].errors?.['maxlength']">El nombre no puede exceder 50 caracteres.</small>
              <small *ngIf="f['name'].errors?.['pattern']">Solo se permiten letras y espacios.</small>
            </div>
          </div>

          <!-- DESCRIPCIÓN -->
          <div class="mb-3">
            <label class="form-label">Descripción *</label>
            <textarea 
              class="form-control" 
              formControlName="description" 
              rows="3"
              [class.is-invalid]="f['description'].invalid && (f['description'].dirty || f['description'].touched)"
            ></textarea>
            <div *ngIf="f['description'].invalid && (f['description'].dirty || f['description'].touched)" class="invalid-feedback">
              <small *ngIf="f['description'].errors?.['required']">La descripción es obligatoria.</small>
              <small *ngIf="f['description'].errors?.['minlength']">La descripción debe tener al menos 10 caracteres.</small>
              <small *ngIf="f['description'].errors?.['maxlength']">La descripción no puede exceder 200 caracteres.</small>
            </div>
          </div>

          <!-- FECHA DE CREACIÓN -->
          <div class="mb-3">
            <label class="form-label">Fecha de Creación *</label>
            <input 
              type="date" 
              class="form-control" 
              formControlName="createdDate"
              [class.is-invalid]="f['createdDate'].invalid && (f['createdDate'].dirty || f['createdDate'].touched)"
            />
            <div *ngIf="f['createdDate'].invalid && (f['createdDate'].dirty || f['createdDate'].touched)" class="invalid-feedback">
              <small>La fecha de creación es obligatoria.</small>
            </div>
          </div>

          <!-- ACTIVE CHECKBOX -->
          <div class="form-check mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              formControlName="active"
              id="checkActive"
            />
            <label class="form-check-label" for="checkActive">Categoría Activa</label>
          </div>

        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" (click)="modalRef.hide()">
            Cancelar
          </button>
          <button 
            class="btn btn-primary" 
            type="button" 
            (click)="save()"
            [disabled]="formCategorie.invalid">
            {{ editingId ? 'Actualizar' : 'Guardar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Diálogo de confirmación para eliminar -->
<app-reusable-dialog
  [visible]="showDeleteDialog"
  [titulo]="'Eliminar Categoría'"
  [mensaje]="'¿Estás seguro de eliminar la categoría ' + (selectedCategorie?.name || '') + '?'"
  [textoAceptar]="'Eliminar'"
  [textoCancelar]="'Cancelar'"
  [tipo]="'danger'"
  (aceptar)="confirmDelete()"
  (cancelar)="cancelDelete()">
</app-reusable-dialog>

<!-- Diálogo de éxito -->
<app-reusable-dialog
  [visible]="showSuccessDialog"
  [titulo]="'Éxito'"
  [mensaje]="successMessage"
  [textoAceptar]="'Aceptar'"
  [textoCancelar]="''"
  [tipo]="'primary'"
  (aceptar)="closeSuccessDialog()">
</app-reusable-dialog>

<!-- Diálogo de error -->
<app-reusable-dialog
  [visible]="showErrorDialog"
  [titulo]="'Error'"
  [mensaje]="errorMessage"
  [textoAceptar]="'Aceptar'"
  [textoCancelar]="''"
  [tipo]="'danger'"
  (aceptar)="closeErrorDialog()">
</app-reusable-dialog>

<!-- Diálogo de error de formulario -->
<app-reusable-dialog
  [visible]="showFormErrorDialog"
  [titulo]="'Error en el formulario'"
  [mensaje]="formErrorMessage"
  [textoAceptar]="'Aceptar'"
  [textoCancelar]="''"
  [tipo]="'danger'"
  (aceptar)="closeFormErrorDialog()">
</app-reusable-dialog>