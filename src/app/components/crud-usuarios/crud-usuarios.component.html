<div class="crud-wrapper bg-slate-900 min-h-screen py-4">

  <div class="crud-usuarios-container">

    <header class="crud-header mb-4 d-flex flex-column flex-md-row align-items-md-center justify-content-between">
      <div>
        <h1 class="crud-title mb-1">
          游녻 Gesti칩n de usuarios
        </h1>
        <p class="crud-subtitle mb-0">
          Administraci칩n del club de lectura
        </p>
      </div>
      <div class="badge-admin mt-2 mt-md-0">
        Panel administrador
      </div>
    </header>

    <div class="row g-3">
      <div class="col-lg-4">
        <div class="card form-card shadow-xl border-0 rounded-4 bg-slate-800 text-slate-100">
          <div class="card-body">

            <h2 class="form-title h6 mb-3">
              {{ editando ? 'Editar usuario' : 'Registrar usuario' }}
            </h2>

            <form [formGroup]="form" class="space-y-2">

              <div class="mb-2">
                <label class="form-label text-slate-200 text-sm">Nombre completo</label>
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="nombre"
                  (keypress)="bloquearNumeros($event)"
                  placeholder="Ej: Ana Torres">
                <div *ngIf="campoInvalido('nombre')" class="form-text text-danger text-xs">
                  Nombre inv치lido (Solo letras, m칤n 3 caracteres).
                </div>
              </div>

              <div class="mb-2">
                <label class="form-label text-slate-200 text-sm">Correo electr칩nico</label>
                <input 
                  type="email" 
                  class="form-control modern-input" 
                  formControlName="email"
                  placeholder="tucorreo@ejemplo.com">
                <div *ngIf="campoInvalido('email')" class="form-text text-danger text-xs">
                  Ingresa un correo v치lido.
                </div>
              </div>

              <div class="mb-2">
                <label class="form-label text-slate-200 text-sm">Tel칠fono</label>
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="telefono"
                  (keypress)="bloquearLetras($event)"
                  maxlength="15"
                  placeholder="0999999999">
                <div *ngIf="campoInvalido('telefono')" class="form-text text-danger text-xs">
                  Solo n칰meros permitidos (m칤n 7 d칤gitos).
                </div>
              </div>

              <div class="mb-2">
                <label class="form-label text-slate-200 text-sm">Ciudad</label>
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="ciudad"
                  (keypress)="bloquearNumeros($event)"
                  placeholder="Guayaquil, Quito, Cuenca...">
                <div *ngIf="campoInvalido('ciudad')" class="form-text text-danger text-xs">
                  La ciudad es obligatoria (Solo letras).
                </div>
              </div>

              <div class="mb-2">
                <label class="form-label text-slate-200 text-sm">Rol</label>
                <select class="form-select modern-input" formControlName="rol">
                  <option value="lector">Lector</option>
                  <option value="donante">Donante</option>
                  <option value="administrador">Administrador</option>
                </select>
              </div>

              <div class="mb-2">
                <label class="form-label text-slate-200 text-sm">Contrase침a</label>
                <input 
                  type="password" 
                  class="form-control modern-input" 
                  formControlName="password"
                  placeholder="M칤nimo 6 caracteres">
                <div *ngIf="campoInvalido('password')" class="form-text text-danger text-xs">
                  La contrase침a es obligatoria (m칤nimo 6 caracteres).
                </div>
              </div>

              <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" formControlName="estadoActivo" id="estadoActivo">
                <label class="form-check-label text-sm text-slate-200" for="estadoActivo">
                  Usuario activo
                </label>
              </div>

              <div class="d-flex gap-2">
                <button type="button" class="btn btn-primary btn-modern flex-grow-1 py-1" (click)="onSubmit()">
                  {{ editando ? 'Actualizar' : 'Guardar' }}
                </button>
                <button type="button" class="btn btn-outline-light btn-sm btn-ghost" (click)="resetFormulario()">
                  Limpiar
                </button>
              </div>

            </form>
          </div>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="card table-card shadow-xl border-0 rounded-4 bg-slate-800 text-slate-100 h-100">
          <div class="card-body d-flex flex-column">

            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3 gap-2">
              <div>
                <h2 class="h6 mb-1">Listado de usuarios</h2>
                <p class="mb-0 text-xs text-slate-400">
                  Haz clic en el 칤cono de l치piz para editar, o en el 칤cono de papelera para eliminar.
                </p>
              </div>
            </div>

            <div class="table-wrapper flex-grow-1">
              <!-- Tabla reutilizable -->
              <app-reusable-table
                [datos]="usuarios"
                [columnas]="columnasTabla"
                (editClick)="onEditarClick($event)"
                (eliminarClick)="onEliminarClick($event)"
                (toggleActivo)="onToggleActivo($event)">
              </app-reusable-table>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Di치logo de confirmaci칩n para eliminar -->
  <app-reusable-dialog
    [visible]="showDeleteDialog"
    [titulo]="'Eliminar usuario'"
    [mensaje]="usuarioParaEliminar ? '쮼st치s seguro de eliminar al usuario ' + usuarioParaEliminar.nombre + '?' : '쮼liminar usuario?'"
    [textoAceptar]="'Eliminar'"
    [textoCancelar]="'Cancelar'"
    [tipo]="'danger'"
    (aceptar)="confirmarEliminar()"
    (cancelar)="cancelarEliminar()">
  </app-reusable-dialog>

  <!-- Di치logo de 칠xito -->
  <app-reusable-dialog
    [visible]="showSuccessDialog"
    [titulo]="dialogTitle"
    [mensaje]="dialogMessage"
    [textoAceptar]="'Aceptar'"
    [textoCancelar]="''"
    [tipo]="'primary'"
    (aceptar)="closeSuccessDialog()">
  </app-reusable-dialog>

  <!-- Di치logo de error -->
  <app-reusable-dialog
    [visible]="showErrorDialog"
    [titulo]="dialogTitle"
    [mensaje]="dialogMessage"
    [textoAceptar]="'Aceptar'"
    [textoCancelar]="''"
    [tipo]="'danger'"
    (aceptar)="closeErrorDialog()">
  </app-reusable-dialog>

</div>