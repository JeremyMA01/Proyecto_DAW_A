
<div class="tabla-wrapper">
  <div class="tabla-card">

    <h2 class="tabla-title">Listado de Libros</h2>

    <table class="tabla-modern">
      <thead>
        <tr>
          @for (col of columnas; track $index) {
            <th>{{ col.label }}</th>
          }
        </tr>
      </thead>

      <tbody>
        @for (fila of pageActual(); track $index) {
          <tr (click)="onFilaClick(fila)" class="row-hover">

            @for (col of columnas; track $index) {
              <td>

                <ng-container [ngSwitch]="col.key">

                  <!-- Estado activo -->
                  <span *ngSwitchCase="'estadoActivo'">
                    <span class="estado-pill" [class.activo]="fila.estadoActivo" [class.inactivo]="!fila.estadoActivo">
                      {{ fila.estadoActivo ? 'Activo' : 'Inactivo' }}
                    </span>
                  </span>

                  <!-- Columna acciones -->
                  <span *ngSwitchCase="'action'" class="acciones">
                    <button class="btn-icon view" (click)="Onview(fila, $event)">
                      <i class="bi bi-eye-fill"></i>
                    </button>

                    <button class="btn-icon edit" (click)="OnEditClick(fila, $event)">
                      <i class="bi bi-pencil-fill"></i>
                    </button>

                    <button class="btn-icon delete" (click)="onEliminarClick(fila, $event)">
                      <i class="bi bi-trash-fill"></i>
                    </button>
                  </span>

                  <!-- Campos comunes + género -->
                  <span *ngSwitchDefault>
                    @if (col.key === 'genre') {
                      {{ obtenerGeneroNombre(fila[col.key]) }}
                    } @else {
                      {{ fila[col.key] }}
                    }
                  </span>

                </ng-container>
              </td>
            }
          </tr>
        }
      </tbody>
    </table>

    <nav class="pagination-modern">
      <button class="page-btn" [disabled]="page === 1" (click)="setPage(page - 1)">Anterior</button>

      @for (p of [].constructor(totalPaginas()); track $index) {
        <button class="page-number" [class.active]="page === ($index + 1)" (click)="setPage($index + 1)">
          {{ $index + 1 }}
        </button>
      }

      <button class="page-btn" [disabled]="page === totalPaginas()" (click)="setPage(page + 1)">Siguiente</button>
    </nav>



<div class="container-fluid mt-4">
  <div class="row mb-3 align-items-center">
    <div class="col-md-6 col-lg-4">
      <div class="input-group input-group-sm border rounded-pill px-3 py-1 bg-white shadow-sm">
        <span class="input-group-text border-0 bg-transparent text-muted">
          <i class="bi bi-search"></i>
        </span>
        <input 
          type="text" 
          class="form-control border-0 shadow-none" 
          placeholder="Filtrar en esta tabla..."
          #txtSearch
          (keyup)="onSearch(txtSearch.value)">
      </div>
    </div>

    <div class="col-md-6 col-lg-8 text-end">
      <button class="btn btn-primary btn-sm rounded-pill px-3 shadow-sm" (click)="onNewClick()">
        <i class="bi bi-plus-lg me-1"></i> Nuevo
      </button>
    </div>
  </div>

  <div class="card shadow-sm border-0 rounded-3">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light">
            <tr>
              @for (col of columnas; track col.key) {
                <th class="px-4 py-3 text-secondary text-uppercase fw-bold" style="font-size: 0.82rem;">
                  {{ col.label }}
                </th>
              }
              <th class="px-4 py-3 text-secondary text-uppercase fw-bold text-center" style="font-size: 0.82rem;">Acciones</th>
            </tr>
          </thead>

          <tbody>
            @for (fila of pageActual(); track $index) {
              <tr class="table-row" (click)="onFilaClick(fila)" style="cursor: pointer">
                @for (col of columnas; track col.key) {
                  <td class="px-4 py-3">
                    @switch (col.key) {
                      
                      @case ('isRecommend') {
                        <span class="badge rounded-pill" 
                              [ngClass]="fila[col.key] ? 'bg-success-subtle text-success' : 'bg-danger-subtle text-danger'">
                          <i class="bi" [ngClass]="fila[col.key] ? 'bi-hand-thumbs-up' : 'bi-hand-thumbs-down'"></i>
                          {{ fila[col.key] ? 'Sí' : 'No' }}
                        </span>
                      }

                      @default {
                        <span class="text-dark">{{ fila[col.key] }}</span>
                      }
                    }
                  </td>
                }
                <td class="px-4 py-3 text-center">
                  <div class="d-flex justify-content-center gap-2" (click)="$event.stopPropagation()">
                    <button class="btn btn-sm btn-outline-warning border-0 rounded-circle" 
                            title="Editar" (click)="OnEditClick(fila)">
                      <i class="bi bi-pencil-fill"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger border-0 rounded-circle" 
                            title="Eliminar" (click)="onEliminarClick(fila)">
                      <i class="bi bi-trash3-fill"></i>
                    </button>
                  </div>
                </td>
              </tr>
            } @empty {
              <tr>
                <td [attr.colspan]="columnas.length + 1" class="text-center py-5 text-muted fst-italic">
                  No se encontraron registros.
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

    </div>
</div>


    <div class="card-footer bg-white border-top-0 py-3">
      <nav class="d-flex justify-content-between align-items-center flex-wrap gap-2">
        <small class="text-muted fw-medium">
          Mostrando página {{page}} de {{totalPaginas()}}
        </small>
        
        <ul class="pagination pagination-sm mb-0">
          <li class="page-item" [class.disabled]="page === 1">
            <button class="page-link" (click)="setPage(page - 1)">Anterior</button>
          </li>
          
          @for (p of [].constructor(totalPaginas()); track $index) {
            <li class="page-item" [class.active]="page === ($index + 1)">
              <button class="page-link" (click)="setPage($index + 1)">{{ $index + 1 }}</button>
            </li>
          }

          <li class="page-item" [class.disabled]="page === totalPaginas()">
            <button class="page-link" (click)="setPage(page + 1)">Siguiente</button>
          </li>
        </ul>
      </nav>
    </div>

  </div>
</div>

